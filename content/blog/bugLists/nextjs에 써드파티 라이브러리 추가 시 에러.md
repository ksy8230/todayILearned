---
title: nextjs에 써드파티 라이브러리 추가 시 에러
date: 2022-09-14
tags: [버그리포트]
publish: true
image: "./bugreport.jpg"
---

## 에러 환경

npm v.8.1.2  
node v.16.13.2

## 에러 현상

Nextjs 기반의 프로젝트 작업 중 팀 내부에서 자주 쓰는 모듈들만 모아둔 써드파티 라이브러리를 추가하려니 설치가 안 됐다.

## 에러 원인

이 라이브러리들이 CRA 기반의 프로젝트 기준으로 작업되었던 모듈들이라는 점을 시작으로 CRA와 Nextjs의 외부 모듈 설치 시 어떤 차이점이 있는지 찾아보았다. 그리고 이 과정에서 CRA와 Nextjs가 외부 모듈을 받아들이는 포맷이 다르다는 걸 알게 되었다.  
프론트 개발자끼리 사용하려고 예쁘게 정리해둔 모듈들을 [rollup.js](https://rollupjs.org/guide/en/)을 이용해 빌드시킨 후 [verdaccio](https://verdaccio.org/)에 배포를 한 뒤 필요한 프로젝트에 추가하는 식으로 사용을 하는데
여태까지 esm 형식으로 CRA에 추가해 왔던 것이 Nextjs에서는 인식이 안 되었던 것이다. Nextjs는 cjs, 즉 common js로만 패키지 모듈을 인식하고 있었다.  
빌드 파일의 용량을 줄이겠다고 컴포넌트를 개발할 때 가능하면 `(라이브러리명)/esm/locale.js` 이런 식으로 범위를 좁혀서 import 시킨 뒤 배포를 했는데 import 구문이 esm 형식이라 cjs 포맷만 받는 프로젝트에서는 에러를 뿜었던 것이다.

## 해결 방법

esm 포맷으로 불러오는 구문들을 제거하여 배포하니 잘 동작한다.  
그런데 정말 Nextjs에서 esm 형식의 포맷을 가져올 방법이 없는걸까? cjs, esm 둘다 설치가 가능한 방안을 찾아봐야겠다.
