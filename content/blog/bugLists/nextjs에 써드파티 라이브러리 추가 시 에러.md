---
title: nextjs에 써드파티 라이브러리 추가 시 에러
date: 2022-09-14
tags: [버그리포트]
publish: true
---

nextjs 기반의 프로젝트로 작업 중... nextjs에 커스텀한 모듈들만 모아둔 써드파티 라이브러리를 추가해야할 일이 생겼다.  
CRA 기반의 프로젝트 기준으로 작업되었던 모듈들이라 정말 미친듯한 에러들이 떴는데... 이 과정에서 CRA와 nextjs가 외부 모듈을 받아들이는 포맷이 다르다는 걸 알게 되었다.  
프론트 개발자끼리 사용하려고 예쁘게 정리해둔 모듈들을 rollup을 이용해 빌드시킨 후 verdaccio에 배포를 한 뒤 필요한 프로젝트에 추가하는 식으로 사용을 하는데  
여태까지 esm 형식으로 CRA에 추가해 왔던 것이 nextjs에서는 인식이 안 되었던 것... nextjs는 cjs, 즉 common js로만 패키지 모듈을 인식하고 있었다.  
빌드 파일의 용량을 줄이겠다고 컴포넌트를 개발할 때 가능하면 -> (라이브러리명)/esm/locale.js 이런 식으로 범위를 좁혀서 import 시킨 뒤 배포를 했는데 이런 것들이 에러를 뿜었던 것.

esm 글자들을 지워주고 재배포하니 예쁘게 잘 동작한다.
