{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/bugLists/그라파나 iframe deny 에러/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Today I Learned"}},"markdownRemark":{"id":"630f92b7-1c2a-580c-b411-43e54ba38411","excerpt":"개발 환경 : 쿠버네티스에 그라파나와 웹서버인 nginx가 있고 리액트 어플리케이션 서버인 http://localhost:3000은 https://${쿠버네티스 배포용 ip}:{쿠버네티스 배포용 port…","html":"<p>개발 환경 : 쿠버네티스에 그라파나와 웹서버인 nginx가 있고 리액트 어플리케이션 서버인 <a href=\"http://localhost:3000%EC%9D%80\">http://localhost:3000은</a> https://${쿠버네티스 배포용 ip}:{쿠버네티스 배포용 port}로 프록시 서버가 연결되어 있다.</p>\n<p>이슈 : 쿠버네티스에 올라가 있는 그라파나 대시보드 화면 URL을 웹에서 iframe 태그에 삽입하니 에러가 뜬다.<br>\n원인 : X-Frame-Options DENY 설정 때문에 iframe을 통해 접근할 수 없는 문제.<br>\n해결 : 그라파나의 설정 파일 중 grafana.ini 파일이 있는데 거기서 <code class=\"language-text\">allow_embedding = true</code> 로 설정.</p>\n<p>또 다른 이슈 : X-Frame-Options는 해결됐는데 이번엔 외부에서 접속할 수 있는 그라파나 주소가 필요했다. 당시엔 localhost:{port}로, 그라파나가 로컬에만 떠있는 상태.<br>\n해결1-1 : grafana 설정에서 루트 url뒤에 /grafana/ 주소 설정하여 프록시가 읽어들일 수 있는 엔트리포인트 주기.<br>\n해결1-1 : nginx 설정에서 /grafana/ 주소로 웹에서 요청시 쿠버네티스의 그라파나 주소로 연결되도록 프록시 설정.<br>\n해결1-2 : 쿠버네티스에서 그라파나를 재시작할 때마다 대시보드 주소가 바뀌기 때문에 여기에 맞춰서 nginx가 바라보고 있는 그라파나 프록시 주소도 함께 업데이트가 되어야 한다. 그걸 간과하고 그라파나만 백날 올렸다 내렸다하니… 프록시가 제대로 먹힐리 없었다.</p>\n<p>grafana.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre style=\"counter-reset: linenumber 0\" class=\"language-yml line-numbers\"><code class=\"language-yml\">root_url = %(protocol)s<span class=\"token punctuation\">:</span>//%(domain)s<span class=\"token punctuation\">:</span>%(http_port)s/grafana/\r\nserve_from_sub_path = true</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>nginx.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre style=\"counter-reset: linenumber 0\" class=\"language-yml line-numbers\"><code class=\"language-yml\">location /grafana/ <span class=\"token punctuation\">{</span>\r\nproxy_set_header Host $http_host;\r\nproxy_set_header X<span class=\"token punctuation\">-</span>Real<span class=\"token punctuation\">-</span>IP $remote_addr;\r\nproxy_set_header X<span class=\"token punctuation\">-</span>Forwarded<span class=\"token punctuation\">-</span>For $proxy_add_x_forwarded_for;\r\nproxy_set_header X<span class=\"token punctuation\">-</span>Forwarded<span class=\"token punctuation\">-</span>Proto $scheme;\r\nproxy_pass         http<span class=\"token punctuation\">:</span>//grafana; // 상단에서 stream 설정되어 있음\r\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>또 다른 이슈 : 웹에서 프록시로 설정된 그라파나 주소가 뜨긴 뜨는데 계속 로그인창만 뜬다.<br>\n원인 : 그라파나 자체 내에서 로그인된 사용자만 그라파나 대시보드를 보도록 리다이렉트 시키는 중.<br>\n해결 : grafana.ini 파일에서 [auth.anonymous] <code class=\"language-text\">enabled = true</code> 로 설정하여 익명의 사용자도 해당 url에 접근 가능하도록 설정.</p>\n<hr>\n<p>결론 프록시 서버에 대한 이해가 부족했다…</p>","frontmatter":{"title":"그라파나 iframe deny 에러","date":"2022-05-04","description":null,"tags":["버그리포트"]},"tableOfContents":""},"previous":{"fields":{"slug":"/bugLists/error code 1/"},"frontmatter":{"title":"npm 빌드 중 erroe code 1"}},"next":{"fields":{"slug":"/project/work/django/0.우당탕탕 기획(update.220721)/"},"frontmatter":{"title":"0. 무작정 장고로 사이드 프로젝트 만들기 - 간단 기획"}}},"pageContext":{"id":"630f92b7-1c2a-580c-b411-43e54ba38411","previousPostId":"6420b966-b155-5304-8b46-5b057dab7f3c","nextPostId":"3bc46d66-d4f7-5eea-809e-6cdee44b1651"}},
    "staticQueryHashes": ["2841359383","3708219967"]}