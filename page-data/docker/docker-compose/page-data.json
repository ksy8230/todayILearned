{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/docker/docker-compose/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Today I Learned"}},"markdownRemark":{"id":"140a5a4c-18b3-52ed-9bab-91fff46d86b6","excerpt":"도커 컴포즈가 무엇인지 궁금해 다시 생활코딩을 찾아갔다. 도커 컴포즈는 쉽게 말하면 shell…","html":"<p>도커 컴포즈가 무엇인지 궁금해 다시 생활코딩을 찾아갔다.<br>\n도커 컴포즈는 쉽게 말하면 shell에서 치는 복잡한 설치 명령어들을 파일 하나에 담아</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker-compose up</code></pre></div>\n<p>이 한줄로 설치를 완료시키는 기능을 해주는 패키지 파일이다.<br>\n해당 강의는 설치형 블로그인 워드프레스를 이용해 예시를 들어 설명해 준다.</p>\n<h3>예시 시나리오</h3>\n<p>아래와 같은 환경을 도커를 이용해 워드프레스를 만든다고 가정하자.<br>\n워드프레스 컨테이너가 존재하고 mysql 컨테이너가 존재할 것이다. 그리고 웹브라우저를 통해 워드프레스에 접근하면 워드프레스에 연결된 mysql에서 특정 작업을 처리하고 그 결과를 워드프레스에게 가져온 뒤 다시 웹브라우저에게 응답할 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/570dec95b68427bd6a6bb7634d9ce6bf/e8a7f/image1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.48101265822785%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAMEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdCMLAP/xAAZEAACAwEAAAAAAAAAAAAAAAACAwEEEhP/2gAIAQEAAQUCri0Zy7pWgxX/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EAB8QAAAFBAMAAAAAAAAAAAAAAAABAhEjAxITISJRYf/aAAgBAQAGPwJeRb9CrJoy4+CRVxuP/8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBITFB/9oACAEBAAE/IaCMz00Q81EeuCLcrbP/2gAMAwEAAgADAAAAEAPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxAAAgMBAQEAAAAAAAAAAAAAAREAITFBUWH/2gAIAQEAAT8QJScRtD6AuSnyNss0lS+OamJdTgZAn//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"도커\"\n        title=\"도커\"\n        src=\"/static/570dec95b68427bd6a6bb7634d9ce6bf/828fb/image1.jpg\"\n        srcset=\"/static/570dec95b68427bd6a6bb7634d9ce6bf/ff44c/image1.jpg 158w,\n/static/570dec95b68427bd6a6bb7634d9ce6bf/a6688/image1.jpg 315w,\n/static/570dec95b68427bd6a6bb7634d9ce6bf/828fb/image1.jpg 630w,\n/static/570dec95b68427bd6a6bb7634d9ce6bf/0ede0/image1.jpg 945w,\n/static/570dec95b68427bd6a6bb7634d9ce6bf/e8a7f/image1.jpg 1138w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>shell로 설치</h3>\n<p>도커 컴포즈가 없다면 아래와 같은 설치 명령어를 사용해 위 시나리오 환경을 구성할 수 있을 것이다.</p>\n<ol>\n<li>\n<p>wordpress_net이라는 도커 네트워크 설치</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker network create wordpress_net</code></pre></div>\n<ul>\n<li>app 컨테이너와 db 컨테이너는 서로 정보를 주고 받을 네트워크가 필요하다</li>\n<li>wordpress_net을 설치하면 app 컨테이너와 db 컨테이너의 호스트를 ip가 아닌 이름으로 사용 가능하게 해준다</li>\n</ul>\n</li>\n<li>\n<p>db 컨테이너 설치</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker <span class=\"token punctuation\">\\</span>\nrun <span class=\"token punctuation\">\\</span>\n    --name <span class=\"token string\">\"db\"</span> <span class=\"token punctuation\">\\</span>\n    -v <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>/db_data:/var/lib/mysql\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"MYSQL_ROOT_PASSWORD=123456\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"MYSQL_DATABASE=wordpress\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"MYSQL_USER=wordpress_user\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"MYSQL_PASSWORD=123456\"</span> <span class=\"token punctuation\">\\</span>\n    --network wordpress_net <span class=\"token punctuation\">\\</span>\nmysql:5.7\n</code></pre></div>\n<ul>\n<li>db라는 이름의 컨테이너가 생성되고 호스트의 $(현재 위치)/db_data 폴더와 컨테이너의 /var/lib/mysql 폴더를 연결한 뒤 mysql 접속을 위한 정보들을 환경변수를 이용해 적어준다. 그리고 앞서 설치한 도커 네트워크로 만든 wordpress_net에 연결한다.</li>\n</ul>\n</li>\n<li>\n<p>app 컨테이너 설치</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker <span class=\"token punctuation\">\\</span>\n    run <span class=\"token punctuation\">\\</span>\n    --name app <span class=\"token punctuation\">\\</span>\n    -v <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>/app_data:/var/www/html\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"WORDPRESS_DB_HOST=db\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"WORDPRESS_DB_USER=wordpress_user\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"WORDPRESS_DB_NAME=wordpress\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"WORDPRESS_DB_PASSWORD=123456\"</span> <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token string\">\"WORDPRESS_DEBUG=1\"</span> <span class=\"token punctuation\">\\</span>\n    -p <span class=\"token number\">8080</span>:80 <span class=\"token punctuation\">\\</span>\n    --network wordpress_net <span class=\"token punctuation\">\\</span>\nwordpress:latest</code></pre></div>\n<ul>\n<li>app 이라는 이름의 컨테이너가 생성되고 호스트의 $(현재 위치)/app_data 폴더와 컨테이너의 /var/www/html 폴더를 연결한 뒤 db 컨테이너에 접속할 정보들을 환경변수를 이용해 적어준다. 그리서 앞서 설치한 도커 네트워크로 만든 wordpress_net에 연결한다.</li>\n<li><strong>app 컨테이너에 80포트와 호스트의 8080포트를 연결하여 웹 브라우저에서 접근 가능하도록 한다.</strong> 이말인 즉, db 컨테이너는 호스트의 어떤 포트와도 연결되어 있지 않고 app 컨테이너만 연결이 가능하여 보안상 안전해 진다.</li>\n</ul>\n</li>\n</ol>\n<p>설치가 완료된 환경 구성을 시각적 자료로 표현하자면 아래와 같을 것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9366721452576d77bcbd07ca5e9cd8b1/b0abb/image2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.63291139240506%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBQEE/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3afPE0kBn8C0H//EABsQAQACAgMAAAAAAAAAAAAAAAEAAhESAxMh/9oACAEBAAEFAswHecuzZrboGWqWmhg8P//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABwQAAEEAwEAAAAAAAAAAAAAABEAAhAhARJRgf/aAAgBAQAGPwJHLq4IxqfE1t7GLQj/xAAaEAEBAQEBAQEAAAAAAAAAAAABEQAhMWGx/9oACAEBAAE/IU2YDMrwRhuKXEG1m2ex739wdytq/GanvD73KAeG/9oADAMBAAIAAwAAABAADwD/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAEBAAICAgMAAAAAAAAAAAABEQAhMUFRkXGhwf/aAAgBAQABPxARNqO5eMfrDZW/Ld+sEUyy4WAK0OzKBAtHSvL8jvOw7/DALEE316yI2+iP7c4iJhCuf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"도커\"\n        title=\"도커\"\n        src=\"/static/9366721452576d77bcbd07ca5e9cd8b1/828fb/image2.jpg\"\n        srcset=\"/static/9366721452576d77bcbd07ca5e9cd8b1/ff44c/image2.jpg 158w,\n/static/9366721452576d77bcbd07ca5e9cd8b1/a6688/image2.jpg 315w,\n/static/9366721452576d77bcbd07ca5e9cd8b1/828fb/image2.jpg 630w,\n/static/9366721452576d77bcbd07ca5e9cd8b1/b0abb/image2.jpg 717w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>docker-compose.yml 로 설치</h3>\n<p>도커 컴포즈 파일을 이용해도 위와 똑같은 설치 환경이 구성된다.<br>\n파일 하나와 명령어 하나면 끝.</p>\n<p>docker-compose.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\">version: \"3.7\"\n\nservices:\n  db:\n    image: mysql:5.7\n    volumes:\n      - ./db_data:/var/lib/mysql\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: 123456\n      MYSQL_DATABASE: wordpress\n      MYSQL_USER: wordpress_user\n      MYSQL_PASSWORD: 123456\n\n  app:\n    depends_on:\n      - db\n    image: wordpress:latest\n    volumes:\n      - ./app_data:/var/www/html\n    ports:\n      - \"8080:80\"\n    restart: always\n    environment:\n      WORDPRESS_DB_HOST: db:3306\n      WORDPRESS_DB_NAME: wordpress\n      WORDPRESS_DB_USER: wordpress_user\n      WORDPRESS_DB_PASSWORD: 123456\n</code></pre></div>\n<p>shell 명령어</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker-compose up</code></pre></div>\n<h3>요청의 흐름</h3>\n<p>예시 docker-compose 파일의 요청 흐름을 다시 정리해 보자면 아래와 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ac2dcf05274afca744cc6e8c5f63949/29d31/image3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAMBAgUE/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB7kYaHSTHgyFAf//EABwQAQACAQUAAAAAAAAAAAAAAAEAEiECAxETFP/aAAgBAQABBQK0B7JvWs3881CvGDB//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHBAAAgIDAQEAAAAAAAAAAAAAAREAEgIQcTKB/9oACAEBAAY/AlLHILmhV/IA8rPXojkVj3X/xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhQVGBkf/aAAgBAQABPyFF+oBeFDX7LIraqDdIF8wbBzWWqBfsj1sSBa117P/aAAwDAQACAAMAAAAQ0wgA/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAQACAgMBAAAAAAAAAAAAAREAITFhQVFxkf/aAAgBAQABPxAhDFdzRjQqa6cIWt/mDcOR77FJWy41Fs2tRe76wgGyFvwyGasTQfuXL3DyOnL9gjydnP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"도커\"\n        title=\"도커\"\n        src=\"/static/7ac2dcf05274afca744cc6e8c5f63949/828fb/image3.jpg\"\n        srcset=\"/static/7ac2dcf05274afca744cc6e8c5f63949/ff44c/image3.jpg 158w,\n/static/7ac2dcf05274afca744cc6e8c5f63949/a6688/image3.jpg 315w,\n/static/7ac2dcf05274afca744cc6e8c5f63949/828fb/image3.jpg 630w,\n/static/7ac2dcf05274afca744cc6e8c5f63949/29d31/image3.jpg 700w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>\n<p>웹브라우저에서 8080 포트로 서버에 요청을 보낸다</p>\n</li>\n<li>\n<p>app 컨테이너에서 열어둔 80 포트로 들어와 php를 타고 /var/www/html/ 파일을 읽어들인다</p>\n</li>\n<li>\n<p>/var/www/html 폴더는 호스트의 /app_data 폴더와 연결되어 있으므로 개발자가 적어둔 db 정보를 가져온다</p>\n</li>\n<li>\n<p>app 컨테이너는 wordpress_net 네트워크를 통해 3306 포트로 열려있는 db 컨테이너의 mysql 서버로 요청을 보낸다</p>\n</li>\n<li>\n<p>db 컨테이너의 /var/lib/mysql 폴더는 호스트의 /db_data 폴더와 연결되어 있으므로 개발자가 적어둔 mysql 정보를 가져와 mysql에 연결 후 결과를 app 컨테이너에게 돌려준다</p>\n</li>\n</ul>","frontmatter":{"title":"생활코딩 Docker compose를 이용해 복잡한 도커 컨테이너 제어하기","date":"2022-01-31","description":null,"tags":["docker"]}},"previous":{"fields":{"slug":"/project/work/nignx_500_error/"},"frontmatter":{"title":"nginx 500 permission error"}},"next":{"fields":{"slug":"/setting/react/without-CRA/"},"frontmatter":{"title":"React 프로젝트 CRA 없이 세팅하기"}}},"pageContext":{"id":"140a5a4c-18b3-52ed-9bab-91fff46d86b6","previousPostId":"6b9160dc-7160-599d-8050-06c5a42affa2","nextPostId":"0b7ee89f-7adf-5434-8922-ca65bab79154"}},
    "staticQueryHashes": ["2841359383","3708219967"]}